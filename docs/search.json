[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Données des aires protégées à Madagascar",
    "section": "",
    "text": "1 Conserver l’histoire des aires protégées à Madagascar : un modèle de données dynamique (2000-2024)"
  },
  {
    "objectID": "index.html#introduction",
    "href": "index.html#introduction",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.1 Introduction",
    "text": "1.1 Introduction\nLes données spatiales des aires protégées, comprenant leur localisation et leurs caractéristiques, constituent une ressource essentielle pour les études sur la conservation. Cependant, les bases de données existantes se limitent souvent aux frontières et caractéristiques actuelles, ignorant les états passés des aires protégées lorsque leurs limites ou attributs ont évolué. Cette lacune entraîne des biais dans les analyses de leur évolution et de leurs impacts.\nDans ce projet, nous proposons une méthode innovante pour produire un modèle de données dynamique documentant l’évolution des aires protégées à Madagascar entre 2000 et 2024. Ce modèle permet de retracer chaque état successif d’une aire protégée, avec ses périodes de validité, offrant ainsi une base plus fiable pour les analyses en conservation et développement."
  },
  {
    "objectID": "index.html#démarche-méthodologique",
    "href": "index.html#démarche-méthodologique",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.2 Démarche méthodologique",
    "text": "1.2 Démarche méthodologique\nNotre démarche repose sur cinq étapes principales :\n\nHarmonisation des données SAPM : Nous consolidons et harmonisons les versions successives des données issues du Système des Aires Protégées de Madagascar (SAPM).\nHarmonisation des données WDPA : Nous appliquons la même méthode aux données de la World Database on Protected Areas (WDPA).\nCréation d’une base réglementaire : En mobilisant la base juridique CNLEGIS, nous construisons une base de données réglementaire détaillée des textes encadrant les aires protégées.\nAnalyse et consolidation : Nous analysons, croisons et consolidons ces différentes sources pour produire un ensemble cohérent, robuste et prêt à être utilisé.\nOutil de vérification visuelle : Nous développons un outil permettant une vérification visuelle des données consolidées afin d’assurer leur fiabilité et leur traçabilité."
  },
  {
    "objectID": "index.html#objectifs-et-perspectives",
    "href": "index.html#objectifs-et-perspectives",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.3 Objectifs et perspectives",
    "text": "1.3 Objectifs et perspectives\nEn documentant chaque étape, notre méthode transparente et reproductible. Ce travail contribue également à une meilleure compréhension des dynamiques de conservation à Madagascar, tout en offrant un cadre adaptable à d’autres contextes géographiques.\nCe projet s’inscrit dans les efforts du BETSAKA pour améliorer l’évaluation des impacts environnementaux et sociaux des aires protégées."
  },
  {
    "objectID": "04_combination_algo.html#décrets-sans-ap",
    "href": "04_combination_algo.html#décrets-sans-ap",
    "title": "5  Aires protégées présentes en 2017 qui n’apparaîssent plus en 2024",
    "section": "5.1 Décrets sans AP",
    "text": "5.1 Décrets sans AP"
  },
  {
    "objectID": "index.html#résumé",
    "href": "index.html#résumé",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.1 Résumé",
    "text": "1.1 Résumé\nLes données spatiales sur les aires protégées sont essentielles pour les études de conservation. Cependant, les bases existantes se limitent souvent aux frontières actuelles, ignorant les évolutions historiques. Cette lacune engendre des biais dans l’analyse de leur impact environnemental et social. Dans ce projet, nous proposons un modèle de données dynamique documentant l’évolution des aires protégées à Madagascar de 2000 à 2024. Ce modèle inclut chaque état successif avec ses périodes de validité, garantissant une base analytique robuste et traçable. Les données seront publiées en accès libre pour favoriser leur utilisation par la communauté scientifique et les praticiens."
  },
  {
    "objectID": "index.html#contexte-et-enjeux",
    "href": "index.html#contexte-et-enjeux",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.2 Contexte et enjeux",
    "text": "1.2 Contexte et enjeux\n\n1.2.1 Importance des données ouvertes\nMadagascar, confronté à une extrême pauvreté, dispose de ressources limitées pour gérer ses données administratives, notamment dans le domaine de la conservation. L’exemple du portail “Redbioma”, aujourd’hui hors ligne, illustre les pertes fréquentes de données essentielles. La mise à disposition de données en open data renforce leur accessibilité, transparence, reproductibilité, et surtout leur persistance.\n\n\n1.2.2 Limites des approches actuelles\nLes bases de données nationales et internationales incluent généralement les caractéristiques actuelles des aires protégées sans tenir compte des modifications passées. Cette approche statique entraîne des pertes d’informations et des biais dans l’évaluation des impacts ou l’étude des dynamiques historiques, notamment dans le contexte des changements de limites (“degazetting”)."
  },
  {
    "objectID": "index.html#originalité-de-la-solution",
    "href": "index.html#originalité-de-la-solution",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.3 Originalité de la solution",
    "text": "1.3 Originalité de la solution\nNotre méthodologie repose sur :\n\nUne documentation exhaustive : Compilation de données issues de cartographies historiques, décrets, gestionnaires d’aires protégées, et autres sources.\nTraçabilité et contrôle de version : Chaque modification est documentée dans un système de gestion de version pour garantir une transparence totale.\nFormats adaptés : Les données sont proposées au format GeoParquet pour les analyses standard et en GML ou OGC Moving Features pour des besoins avancés.\nConstruction rétrospective : La base est reconstruite à partir des états récents vers les états passés."
  },
  {
    "objectID": "index.html#méthodologie",
    "href": "index.html#méthodologie",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.4 Méthodologie",
    "text": "1.4 Méthodologie\n\nHarmonisation des données SAPM : Consolidation des versions successives, notamment entre 2002 et 2011.\nHarmonisation des données WDPA : Intégration des données internationales selon la même approche.\nCréation d’une base réglementaire : Extraction et structuration des textes juridiques via la base CNLEGIS.\nAnalyse et consolidation : Croisement des sources pour produire un ensemble cohérent.\nOutil de vérification visuelle : Développement d’un outil interactif pour valider la qualité et la traçabilité des données consolidées."
  },
  {
    "objectID": "index.html#résultats-attendus",
    "href": "index.html#résultats-attendus",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.5 Résultats attendus",
    "text": "1.5 Résultats attendus\nNous publions un jeu de données couvrant Madagascar entre 2000 et 2024, accessible via un portail pérenne. Ce modèle permettra de corriger des biais observés dans des études emblématiques, offrant des conclusions plus fiables sur l’impact de la conservation."
  },
  {
    "objectID": "index.html#perspectives",
    "href": "index.html#perspectives",
    "title": "Données des aires protégées à Madagascar",
    "section": "1.6 Perspectives",
    "text": "1.6 Perspectives\nCe projet contribue à une meilleure compréhension des dynamiques de conservation et propose un cadre méthodologique réplicable dans d’autres contextes. En intégrant des pratiques ouvertes et transparentes, il répond aux défis de la gestion des données dans les pays en développement tout en offrant des outils adaptés aux besoins des chercheurs et gestionnaires."
  },
  {
    "objectID": "01_sapm_data.html#angap-2002",
    "href": "01_sapm_data.html#angap-2002",
    "title": "2  Harmonisation des données SAPM",
    "section": "2.1 ANGAP 2002",
    "text": "2.1 ANGAP 2002\nAvant la création du SAPM, l’ANGAP était la seule entité chargée de gérer les aires protégées, et donc leurs données. L’ANGAP avait dans ce cadre transmis à l’institut national de géographie malgache (FTM) pour la mise à jour de la base de donnée topographique (BD 500).\n\n\nCode\n# On charge les librairies nécessaires\nlibrary(tidyverse) # Aide à la manipulation de données\nlibrary(sf) # Pour traiter des données spatiales (vectorielles)\nlibrary(tmap) # Pour faire de jolies cartes\nlibrary(gt) # Pour faire de jolis tableaux\n\n# Specify the source repository \ndata_dir &lt;- \"sources/\"\n# Specify CRS\nmy_crs &lt;- 29702\n\n# Load and preprocess the shapefile\nangap_2002 &lt;- st_read(paste0(data_dir, \"ap_angap BD 500/ap_angap.shp\"), \nquiet = TRUE) %&gt;%\n  st_set_crs(my_crs) %&gt;%  # Laborde Magasiaraka CRS\n  mutate(has_info = ifelse(is.na(CLASSEMENT), \n                           \"Attributs absents\", \n                           \"Attributs présents\"),\n         has_name = case_when(is.na(NOM) ~ \"Pas de nom\",\n                              NOM == \"Hors AP\" ~ \"Hors AP\",\n                              .default = \"Nommé\"))\n\n# Separate datasets: \"Pas de nom\", \"Hors AP\", and \"Nommé\"\nangap_pas_de_nom &lt;- angap_2002 %&gt;% filter(has_name == \"Pas de nom\")\nangap_hors_ap &lt;- angap_2002 %&gt;% filter(has_name == \"Hors AP\")\nangap_named &lt;- angap_2002 %&gt;% filter(has_name == \"Nommé\")\n\n# Set tmap to interactive mode\ntmap_mode(\"view\")\n\n# Create the map with three layers\ntm_shape(angap_named) +\n  tm_fill(col = \"has_info\", \n          id = \"NOM\",\n          popup.vars = names(st_drop_geometry(angap_named))) +\n  tm_borders(col = \"black\", lwd = 0.5) +  # Default borders for named features\ntm_shape(angap_pas_de_nom) +\n  tm_fill(col = \"has_info\", \n          id = \"NOM\",\n          popup.vars = names(st_drop_geometry(angap_pas_de_nom)),\n          legend.show = FALSE) +\n  tm_borders(col = \"red\", lwd = 3) +  # Thick red borders for \"Pas de nom\"\ntm_shape(angap_hors_ap) +\n  tm_fill(col = \"has_info\", \n          id = \"NOM\",\n          popup.vars = names(st_drop_geometry(angap_hors_ap)),\n          legend.show = FALSE) +\n  tm_borders(col = \"blue\", lwd = 3) + # Thick blue borders for \"Hors AP\"\n  tm_add_legend(type = \"fill\", \n                labels = c(\"Pas de nom\", \"Hors AP\"), \n                col = c(\"red\", \"blue\"), \n                lwd = c(3, 3, 0.5), \n                title = \"Contour\")\n\n\n\n\n\n\n\nLe champ “classement” de ce jeu de données fait référence à des décrets parus jusqu’en 1998 Mais il fait aussi référence à 11 entités qui n’ont pas de métadonnées les caractérisant.\nParmi celles-ci, 6 n’ont pas de nom :\n\nLe Parc National d’Ankarafantsika, né en 2002 de la fusion de la réserve naturelle intégrale n°15 d’Ankarafantsika et de la réserve - forestière d’Anktarafantsika.\nMantadia, dont les limites ont été étendues en 2002.\nTsingy de Namoroka, créé en 1927 et devenu parc national en 2002.\n\nTout indique qu’il s’agit d’un jeu datant de 2002 (cohérent avec les indications qui m’ont été données quand le jeu m’a été remis)."
  },
  {
    "objectID": "01_sapm_data.html#evolution-du-sapm-2002-2011",
    "href": "01_sapm_data.html#evolution-du-sapm-2002-2011",
    "title": "2  Harmonisation des données SAPM",
    "section": "2.2 Evolution du SAPM 2002-2011",
    "text": "2.2 Evolution du SAPM 2002-2011\nCe jeu de données a été publié en ligne par un consultant du SAPM, avec la référence suivante : Evolution of the Madagascar Protected Area System (SAPM), Tom Allnut, https://hub.arcgis.com/content/4218737646234c7cab1c7a20e2c2489d/about\nIt is provided as a .mpk, which is in fact a zip including shapefiles. We convert to Zip and open the shapefiles.\n\n\nCode\n# Specify the directory path\ndir_path &lt;- paste0(data_dir, \"sapm_evolution_2012/commondata/data1\")\n\n# List all .shp files in the directory\nshapefile_paths &lt;- list.files(path = dir_path, \n                              pattern = \"\\\\.shp$\", \n                              full.names = TRUE, \n                              recursive = TRUE)\n\n# Extract the filenames without the full path\nshapefile_names &lt;- basename(shapefile_paths)\n\n# Filter shapefiles with a date in the filename (e.g., \"2008\", \"2009\", etc.)\ndate_shapefiles &lt;- shapefile_paths[str_detect(shapefile_names, \"20[0-9]{2}\")]\n\n# Load and bind the shapefiles\nsapm_evol_2001_2011 &lt;- date_shapefiles %&gt;%\n  map(st_read, quiet = TRUE) %&gt;%    # Read each shapefile\n  reduce(bind_rows) %&gt;%\n  mutate(YEAR = str_extract(YEAR, \"\\\\d{4}\")) %&gt;% # Extract the 4-digit year\n  st_transform(crs = my_crs) # On passe les données en laborde malgache\n\nsapm_evol_2001_2011 %&gt;%\n  filter(YEAR == 2002) %&gt;%\n  tm_shape() +\n  tm_borders(col = \"blue\") + \n  tm_shape(angap_2002) +\n  tm_fill(col = \"red\", alpha = 0.5) + \n  tmap_options(check.and.fix = TRUE)\n\n\n\n\n\n\n\nCode\n# Save the data to a specified path\nwrite_rds(sapm_evol_2001_2011, \"data/sapm_evol_2001_2011.rds\")"
  },
  {
    "objectID": "01_sapm_data.html#sapm-2013",
    "href": "01_sapm_data.html#sapm-2013",
    "title": "2  Harmonisation des données SAPM",
    "section": "2.3 SAPM 2013",
    "text": "2.3 SAPM 2013\n\nOù a été trouvé ce jeu de données : Vieilledent ?\n\n\n\nCode\n# Try encoding = \"UTF-8\" or \"LATIN1\" depending on the data\nsapm_2013 &lt;- st_read(paste0(data_dir,\"SAPM 2013/limite_sapm.shp\"), \n  quiet = TRUE, options = \"ENCODING=WINDOWS-1252\") %&gt;%\n  st_set_crs(4326) %&gt;%  # Transform to WGS 84 (EPSG:4326)\n  st_make_valid() %&gt;%  # Fix invalid geometries\n  st_transform(my_crs)\n\n# Step 2: Remove potential sites\nsapm_2013 &lt;- sapm_2013 %&gt;% filter(!st_is_empty(geometry)) %&gt;%\n  filter(!(DESCRIPTIO %in% c(\"Site Prioritaire AP\", \"Sites Importants Koloala\", \"Sites Potentiels AP\",\n    \"Sites Potentiels AP Marine\", \"Sites Potentiels Koloala\")))\n\nwrite_rds(sapm_2013, \"data/sapm_2013.rds\")\n\n# Create and format the table\nsapm_2013 %&gt;%\n  st_drop_geometry() %&gt;%\n  group_by(DESCRIPTIO) %&gt;%\n  summarise(n = n(),\n            total_area = sum(HECTARES, na.rm = TRUE)) %&gt;%\n  rename(Catégorie = DESCRIPTIO) %&gt;%  # Rename column for display\n  gt() %&gt;%\n  tab_header(\n    title = \"Données SAPM 2013\"  # Add title to the table\n  ) %&gt;%\n  fmt_number(\n    columns = c(total_area),  # Format the total_area column\n    decimals = 0,                # Round to 0 decimals\n    use_seps = TRUE              # Use thousand separators\n  ) %&gt;%\n  cols_label(\n    n = \"Nombre d'éléments\",      # Label for the 'n' column\n    total_area = \"Superficie totale (ha)\")  # Label for the area column\n\n\n\n\n\n\n  \n    \n      Données SAPM 2013\n    \n    \n    \n      Catégorie\n      Nombre d'éléments\n      Superficie totale (ha)\n    \n  \n  \n    AP gérée par MNP\n74\n3,824,629\n    Aire Protegée à Statut Temporaire\n77\n13,406,519\n    Extension AP MNP\n7\n672,300\n    Nouvelle Aire Protégée\n121\n6,023,266\n  \n  \n  \n\n\n\n\nCode\n# Step 3: Plot the shapefile using tmap\ntm_shape(sapm_2013) + \n  tm_fill(col = \"DESCRIPTIO\") + \n  tmap_options(check.and.fix = TRUE)\n\n\n\n\n\n\n\nJ’ai un doute sur l’origine de ce jeu de données."
  },
  {
    "objectID": "01_sapm_data.html#sapm-2017",
    "href": "01_sapm_data.html#sapm-2017",
    "title": "2  Harmonisation des données SAPM",
    "section": "2.4 SAPM 2017",
    "text": "2.4 SAPM 2017\nCe jeu de données nous a été remis par la FAPBM. Il s’agit visiblement des données SAPM mises à jour en mars 2017.\nL’un des points du périmètre de l’aire protégée Andrafiamena Andavakoera (index 32, sommet numéro 841) est localisé de manière aberrante, formant un papillon et entraînant des erreurs topologiques. La fonction st_make_valid retire ce point aberrant.\n\n\nCode\n# Load and transform data\nsapm_2017 &lt;- st_read(paste0(data_dir, \"sapm_201703017_om_surface/sapm_201703017_om_surface.shp\"),\n                     options = \"ENCODING=WINDOWS-1252\") %&gt;%\n  st_transform(my_crs) %&gt;%\n  st_make_valid()\n\n\noptions:        ENCODING=WINDOWS-1252 \nReading layer `sapm_201703017_om_surface' from data source \n  `C:\\Users\\fbede\\Documents\\Statistiques\\conservation-dynamic-madagascar\\sources\\sapm_201703017_om_surface\\sapm_201703017_om_surface.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 123 features and 23 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 58336.43 ymin: 57373.5 xmax: 833924.5 ymax: 1562970\nProjected CRS: laborde\n\n\nCode\n# Save the data\nwrite_rds(sapm_2017, \"data/sapm_2017.rds\")\n\ntm_shape(sapm_2017) +\n  tm_polygons(col = \"CATEG_IUCN\")"
  },
  {
    "objectID": "01_sapm_data.html#sapm-2024",
    "href": "01_sapm_data.html#sapm-2024",
    "title": "2  Harmonisation des données SAPM",
    "section": "2.5 SAPM 2024",
    "text": "2.5 SAPM 2024\n\n\nCode\n# Load shapefile\nsapm_2024 &lt;- st_read(paste0(data_dir, \"Shape AP mai2023/dernier version shape_ap_28042023.shp\"), \n                   quiet = TRUE)\n\n# Check for invalid geometries\ninvalid_geometries &lt;- sapm_2024 %&gt;%\n  rownames_to_column(var = \"index\") %&gt;%\n  rowwise() %&gt;%\n  mutate(is_valid = st_is_valid(geometry)) %&gt;%\n  filter(!is_valid) %&gt;%\n  select(Index = index, Nom = SHORT_NAME, Source = path)\n\n# Create a folder to save the images\noutput_dir &lt;- \"invalid_geometry_plots\"\ndir.create(output_dir, showWarnings = FALSE)\n\n# Loop through invalid geometries and save the plots\nfor (i in seq_len(nrow(invalid_geometries))) {\n  geometry_index &lt;- invalid_geometries$Index[i]\n  \n  # Generate a file name\n  plot_file &lt;- file.path(output_dir, paste0(\"geometry_\", geometry_index, \".png\"))\n  \n  # Save the plot\n  png(plot_file)\n  plot(st_geometry(sapm_2024[geometry_index, ]))\n  dev.off()\n}\n\n# Add image file paths to the invalid geometries table\ninvalid_geometries &lt;- invalid_geometries %&gt;%\n  mutate(\n    Geometrie = paste0(output_dir, \"/geometry_\", Index, \".png\")\n  )\n\n# Display the table with gt\nif (nrow(invalid_geometries) == 0) {\n  message(\"All geometries are valid.\")\n} else {\n  invalid_geometries %&gt;%\n    st_drop_geometry() %&gt;%\n    gt() %&gt;%\n    text_transform(\n      locations = cells_body(columns = Geometrie),\n      fn = function(x) {\n        local_image(filename = x, height = 100)  # Embed local image with specified height\n      }\n    ) %&gt;%\n    tab_header(\n      title = \"Géométries invalides\",\n      subtitle = \"Liste des géométries invalides\"\n    )\n}\n\n\n\n\n\n\n  \n    \n      Géométries invalides\n    \n    \n      Liste des géométries invalides\n    \n    \n      Index\n      Nom\n      Source\n      Geometrie\n    \n  \n  \n    3\nCM7B\nNA\n\n    8\nMangiho\nNA\n\n    12\nIVOHIBORO\nD:\\ASA AP\\FOREST SHAPE.shp\n\n    22\nBehara Tranomaro\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    34\nTorotorofotsy\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    47\nAndrafiamena Andavakoera\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    50\nMenabe Antimena\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    61\nAnalalava\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    65\nMakirovana Tsihomanaomby\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    68\nPointe à Larrée\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    70\nAntrema\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    107\nPic d'Ivohibe\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    108\nRanomafana\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    112\nZahamena\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    121\nBemanevika\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    131\nCOMATSA Nord\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n    133\nNord-Ifotaka\nD:\\SHAPE AP\\Shapfile vaovao\\sapm_201703017_dd\\sapm_201703017_dd.shp\n\n  \n  \n  \n\n\n\n\nCode\n# Now try to make this valid\n\nsapm_2024_valid &lt;- sapm_2024 %&gt;%\n  st_make_valid()\n\n# Identify invalid geometries\ninvalid_geometries &lt;- sapm_2024_valid %&gt;%\n  filter(!st_is_valid(geometry))\n\n#  Print the names (or identifiers) of the invalid geometries\n# Replace 'NOM' with the actual column containing the name or identifier\nif (nrow(invalid_geometries) &gt; 0) {\n  cat(\"Invalid geometries found:\\n\")\n  print(invalid_geometries$SHORT_NAME)  # Adjust this to match your column name\n} else {\n  cat(\"All geometries are valid.\\n\")\n}\n\n\nInvalid geometries found:\n[1] \"CM7B\"                     \"Mangiho\"                 \n[3] \"IVOHIBORO\"                \"Andrafiamena Andavakoera\"\n\n\nCode\n# Step 5: Filter out invalid geometries for now to plot the valid ones\nsapm_2024_valid_clean &lt;- sapm_2024_valid %&gt;%\n  filter(st_is_valid(geometry))\n\nwrite_rds(sapm_2024_valid_clean, \"data/sapm_2024.rds\")\n\n# Step 6: Plot the valid geometries using tmap\ntm_shape(sapm_2024_valid_clean) +\n  tm_fill(col = \"blue\", alpha = 0.5) + \n  tm_shape(sapm_2017) +\n  tm_fill(col = \"red\", alpha = 0.5)"
  },
  {
    "objectID": "03_legal_docs.html#objet",
    "href": "03_legal_docs.html#objet",
    "title": "4  Création d’une base réglementaire à partir de CNLEGIS",
    "section": "4.1 Objet",
    "text": "4.1 Objet\nLe processus de création, modification ou disparition des aires protégées passe par des lois, décrets et arrêtés officels. Ces éléments réglementaires sont dispersés dans divers textes juridiques, que nous allons ici collecter et consolider à partir de la base du Centre National d’Informatoin et de Documentation Legislative et Juridique (CNLEGIS). Cette instance centralise les textes réglementaires à Madagascar et propose un moteur de recherche permettant de trouver les documents pertinents en fonction de recherches full-text."
  },
  {
    "objectID": "03_legal_docs.html#extraction-des-textes-pertinents",
    "href": "03_legal_docs.html#extraction-des-textes-pertinents",
    "title": "4  Création d’une base réglementaire à partir de CNLEGIS",
    "section": "4.2 Extraction des textes pertinents",
    "text": "4.2 Extraction des textes pertinents\nLa base CNLEGIS ne propose pas d’API, donc l’extraction a dû être réalisée manuellement. Nous avons simplement entré la requête “aire protégée”, ce qui a retourné 131 résultats. Nous avons extrait les 14 pages web correspondantes. Le code ci-dessous extrait l’information pertinente, la nettoie et la restitue sous forme de tableaux.\n\n\nCode\nlibrary(rvest)\nlibrary(tidyverse)\nlibrary(sf)\n\n# Specify the source repository \ndata_dir &lt;- \"sources/\"\n# Directory containing the HTML files\ninput_dir &lt;- paste0(data_dir, \"Décrets/CNLEGIS\")\n\n\n# Columns to select\nkeep_columns &lt;- c(\n  \"DATE(S)\", \"DATE TEXTES\", \"TEXTE(S)\", \"TYPE\", \"NUM TEXTE\", \"NUM\", \"OBJET\",\n  \"OBJET MG\", \"NUM JO\", \"DATE JO\", \"DATE JO FR\", \"PAGE JO\", \"ETAT\", \"NOTE(S)\",\n  \"NOTES MG\", \"DOC PDF FR\", \"DOC PDF MG\", \"MINISTERE(S)\", \"id\", \"HTML FR\", \n  \"HTML MG\")\nkeep_types &lt;- c(\n  \"Constitution\", \"Loi constitutionnelle\", \"Loi organique\", \"Loi\",\n  \"Ordonnance\", \"Décret\", \"Arrêté\", \"Circulaire\", \"Décision\",\n  \"Instruction\", \"Note\", \"Délibération\", \"Arrêt\", \"Avis\", \"Palmarès\",\n  \"Procès verbal\", \"Exposé des motifs de la loi\", \"Jugement\", \"Déclaration\")\n\n# Function to clean column names\nclean_column_names &lt;- function(names) {\n  names %&gt;%\n    str_replace_all(\"\\\\(|\\\\)\", \"\") %&gt;%  # Remove parentheses\n    str_replace_all(\" \", \"_\") %&gt;%      # Replace spaces with underscores\n    str_to_lower()                     # Convert to lowercase\n}\n\n\n\n# Function to extract the desired table from a single HTML file\nextract_table &lt;- function(file_path) {\n  # Read the HTML file\n  html &lt;- read_html(file_path)\n  \n  # Extract the table\n  table &lt;- html %&gt;%\n    html_node(\"table#Lst_docs\") %&gt;%\n    html_table(fill = TRUE)\n  \n  \n  # Select the relevant columns\n  selected_columns &lt;- table %&gt;%\n    select(all_of(keep_columns)) %&gt;%\n    filter(TYPE %in% keep_types)\n  \n   colnames(selected_columns) &lt;- clean_column_names(colnames(selected_columns))\n\n      # Ensure all columns are converted to text\n   selected_columns&lt;- selected_columns %&gt;%\n     mutate(across(everything(), as.character))\n   \n  return(selected_columns)\n}\n\n# Get a list of all HTML files in the directory\nhtml_files &lt;- list.files(input_dir, pattern = \"\\\\.html$\", full.names = TRUE)\n\n# Apply the extraction function to all files\nall_results &lt;- map_dfr(html_files, extract_table)\n\nall_results |&gt;\n  select(-html_fr, -html_mg, -objet_mg, -textes, -num, -doc_pdf_fr, -doc_pdf_mg) |&gt; \n   DT::datatable(height = 10)"
  },
  {
    "objectID": "03_legal_docs.html#classification-par-type-daire-protégée",
    "href": "03_legal_docs.html#classification-par-type-daire-protégée",
    "title": "4  Création d’une base réglementaire à partir de CNLEGIS",
    "section": "4.3 Classification par type d’aire protégée",
    "text": "4.3 Classification par type d’aire protégée\nPour mieux organiser les données extraites, les textes sont classifiés selon le type de transformation qu’elles opèrent (création, modification, prorogation, etc.) à l’aide de règles de typologie.\n\n\nCode\n# Add typology columns\nclass_results &lt;- all_results %&gt;%\n  mutate(\n    creation_definitive = str_detect(\n      textes, regex(\"(?&lt;!en )(création|crétion de l'aire protégée)\", \n                    ignore_case = TRUE)),\n    modifiant = str_detect(textes, regex(\"modifiant\", ignore_case = TRUE)),\n    prorogation = str_detect(textes, regex(\"prorog\", ignore_case = TRUE)),\n    delegation_gestion = str_detect(\n      textes, regex(\"délégation de gestion\", ignore_case = TRUE)),\n    mise_protection_temporaire = str_detect(\n      textes, regex(\"protection temporaire\", ignore_case = TRUE)),\n\n    nomination = str_detect(textes, regex(\"nomination\", ignore_case = TRUE))) %&gt;%\nmutate(\n    total_true = rowSums(select(., creation_definitive:nomination), na.rm = TRUE),\n    concatenated_true = pmap_chr(\n      select(., creation_definitive:nomination),\n      ~ paste(names(which(c(...))), collapse = \", \")\n    ),\n    .before = everything()\n  ) %&gt;%\n  filter(!(total_true == 0)) %&gt;%\n  filter(!(total_true == 1 & nomination)) %&gt;% # On enlève le copil Sydney\n  filter(!(str_detect(textes, \"fonctionnement du Comité de Pilotage\"))) %&gt;%\n  filter(!(str_detect(textes, \"fonctionnement de la Commission\"))) %&gt;%\n  filter(!(str_detect(textes, \"organisation du Comité\")))\n\n\nDeux exceptions méritent d’être relevées :\n\nUn cas important est l’Arrêté Interministériel n° 18633/2008/MEFT/MEM du 17 octobre 2008 portant mise en protection temporaire globale des sites visés par l’Arrêté interministériel n° 17914 du 18 octobre 2006 et levant la suspension de l’octroi des permis miniers et forestiers pour certains sites. Cette décision s’applique à 97 nouvelles aires protégées en cours de création et 29 sites prioritaires pour la biodiversité et la gestion forestière.\n\nCe dernier a été amendé par l’Arrêté interministériel n° 52005/2010 du 20 décembre 2010 modifiant l’arrêté interministériel Mine-Forêts n°18633 du 17 octobre 2008 portant mise en protection temporaire globale des sites visés par l’arrêté n°17914 du 18 octobre 2006 et levant la suspension de l’octroi des permis miniers et forestiers pour certains sites. Cette décision s’applique à 95 aires protégées (24 ayant déjà un statut de protection temporaire).\n\nCes deux textes concernent une liste très étendue de sites potentiels, qui ne sont pas nommément listés dans le texte. On a juste une carte (peu précise) et une somme de zones concernées (en nombre et en surface)."
  },
  {
    "objectID": "03_legal_docs.html#appariement-des-noms-daires-protégées-entre-cnlegis-et-sapm",
    "href": "03_legal_docs.html#appariement-des-noms-daires-protégées-entre-cnlegis-et-sapm",
    "title": "4  Création d’une base réglementaire à partir de CNLEGIS",
    "section": "4.4 Appariement des noms d’aires protégées entre CNLEGIS et SAPM",
    "text": "4.4 Appariement des noms d’aires protégées entre CNLEGIS et SAPM\nOn va avoir besoin de rapprocher ces textes juridiques des données spatiales SAPM et WDPA. On doit le faire à partir des noms des aires protégées, mais ceux-ci ne sont pas normalisés. Une première étape essentielle consiste à extraire ces noms et à les nettoyer avant de procéder à la recherche de correspondances avec les bases spatiales.\n\n\nCode\nclass_results &lt;- class_results %&gt;%\n  mutate(\n    pa = str_extract(\n      textes, regex(\"[\\\"«](.*?)[\\\"»,]|nommée\\\\s*(.*?)[»,]\", ignore_case = TRUE)\n    ),\n    pa = ifelse(\n      is.na(pa),\n      str_extract(\n        textes, regex(\"nommée\\\\s*(.*?)[\\\"]\", ignore_case = TRUE)\n      ),\n      pa\n    ),\n    pa = ifelse(\n      str_detect(textes, \"respectivement\"),\n      str_extract(\n        textes,\n        regex(\"respectivement\\\\s+(.*?)(?=\\\\.|N°|ETAT)\", ignore_case = TRUE)\n      ),\n      pa\n    ),\n    pa = str_replace(pa, \"\\\"Complexe des Aires\", \"Complexe des Aires\"), \n    pa = str_remove(pa, \"^nommée\\\\s*\"),  # Supprime \"nommée\"\n    pa = str_remove(pa, \"^respectivement\\\\s*\"),  # Supprime \"nommée\"\n    pa = str_remove(pa, \"(?&lt;=\\\")[^\\\"«]*$\"),  # Supprime tout après le 2e guillemet\n    pa = str_remove_all(pa, \"[\\\"«»]\"),  # Supprime les quotes\n    pa = str_trim(pa),  # Supprime les espaces en trop\n    pa = str_remove(pa, \",$\"),\n    pa = str_remove(pa, \"^'\"),\n    .before = textes\n  )\n\n\nUne fois les noms des aires protégées concernées extraites de chaque texte, on les compare aux noms de la base SAPM. On le fait tout d’abord automatiquement avec un algorithme d’appariement approximatif (“fuzzy matching”), qui tient compte des variations d’orthographe ou des dénominations multiple.\n\n\nCode\nlibrary(stringdist)\nlibrary(fuzzyjoin)\n\n\nsapm_2017 &lt;- read_rds(\"data/sapm_2017.rds\")\n\n\n\nsapm_2017 %&gt;%\n  pluck(\"SHORT_NAME\")\n\n\n  [1] \"Ambararata Londa\"             \"Ambatotsirongorongo\"         \n  [3] \"Ambohidray\"                   \"Ambohijanahary\\n\"            \n  [5] \"Angavo\"                       \"Behara Tranomaro\"            \n  [7] \"Bemarivo\"                     \"Bongolava\"                   \n  [9] \"Kasijy\"                       \"Maningozy\"                   \n [11] \"Ranobe bay\"                   \"Ranobe PK32\"                 \n [13] \"Sud-Ouest Ifotaky\"            \"Tampoketsa d'Analamaitso\\n\"  \n [15] \"Vohidefo\"                     \"Mahavavy Kinkony\"            \n [17] \"Mangoky Ihotry\"               \"Tsitongambarika\"             \n [19] \"Torotorofotsy\"                \"Beanka\"                      \n [21] \"Sahafina\"                     \"Velondriake\"                 \n [23] \"Ambodivahibe\"                 \"Ankeniheny-Zahamena\"         \n [25] \"Ambositra-Vondrozo\"           \"Tampolo\"                     \n [27] \"Bombetoka Beloboka\"           \"Ambondrobe\"                  \n [29] \"Lac Alaotra\"                  \"Rivière Nosivolo\"            \n [31] \"Allée des Baobabs\"            \"Andrafiamena Andavakoera\"    \n [33] \"Anjozorobe-Angavo\"            \"Loky Manambato\"              \n [35] \"Menabe Antimena\"              \"Maromizaha\"                  \n [37] \"Tsinjoriake\"                  \"Nosy Antsoha\"                \n [39] \"Ampanangandehibe-Behasina\"    \"Analabe Betanatanana\"        \n [41] \"Mahialambo\"                   \"Mangabe-Ranomena-Sahasarotra\"\n [43] \"Agnakatrika\"                  \"Agnalazaha\"                  \n [45] \"Ampasindava\"                  \"Analalava\"                   \n [47] \"Ankarabolava\"                 \"Alandraza Analavelo\"         \n [49] \"Galoko-Kalobinono\"            \"Makirovana Tsihomanaomby\"    \n [51] \"Ibity\"                        \"Oronjia\"                     \n [53] \"Pointe à Larrée\"              \"Vohidava-Betsimalaho\"        \n [55] \"Antrema\"                      \"Ambatovaky\"                  \n [57] \"Ambohitantely\"                \"Analamazaotra\"               \n [59] \"Analamerana\"                  \"Andohahela\"                  \n [61] \"Andranomena\"                  \"Andringitra\\n\"               \n [63] \"Anjanaharibe-Sud\"             \"Ankarafantsika\"              \n [65] \"Ankarana\"                     \"Baie de Baly\"                \n [67] \"Bemaraha\"                     \"Betampona\"                   \n [69] \"Bezà-Mahafaly\"                \"Bora\"                        \n [71] \"Cap Sainte Marie\"             \"Sahamalaza-Iles Radama\"      \n [73] \"Isalo\"                        \"Kalambatritra\"               \n [75] \"Kirindy Mité\"                 \"Lokobe\\n\"                    \n [77] \"Mananara Nord\\n\"              \"Mangerivola\"                 \n [79] \"Manombo\"                      \"Manongarivo\"                 \n [81] \"Mantadia\"                     \"Marojejy\"                    \n [83] \"Marolambo\"                    \"Marotandrano\"                \n [85] \"Masoala\"                      \"Befotaka-Midongy du Sud\"     \n [87] \"Mikea\"                        \"Montagne d'Ambre\"            \n [89] \"Nosy Hara\"                    \"Nosy Mangabe\"                \n [91] \"Nosy Tanikely\"                \"Nosy Ve Androka\"             \n [93] \"Pic d'Ivohibe\"                \"Ranomafana\"                  \n [95] \"Tsaratanàna\"                  \"Tsimanampesotse\"             \n [97] \"Namoroka\"                     \"Zahamena\"                    \n [99] \"Zombitse-Vohibasia\"           \"Ambatoatsinanana\"            \n[101] \"Petriky\"                      \"Mandena\"                     \n[103] \"Itremo\"                       \"Montagne des Français\"       \n[105] \"Tsimembo Manambolomaty\"       \"Mandrozo\"                    \n[107] \"Bemanevika\"                   \"Mahimborondro\"               \n[109] \"Manjakatompo Ankaratra\"       \"Andreba\"                     \n[111] \"Ankarea\"                      \"Ankivonjy\"                   \n[113] \"Makira\"                       \"Soariake\"                    \n[115] \"Amoron'i Onilahy\"             \"Ankodida\"                    \n[117] \"COMATSA Nord\"                 \"COMATSA Sud\"                 \n[119] \"Nord-Ifotaka\"                 \"Iles Barren\"                 \n[121] \"Ambatofotsy\"                  \"Ampotaka-Ankorabe\"           \n[123] \"Analalava\"                   \n\n\nCode\nclass_results %&gt;%\n  pluck(\"pa\")\n\n\n  [1] \"Ankafobe\"                                                                                                                                          \n  [2] \"Ivohiboro\"                                                                                                                                         \n  [3] \"Tsinjoarivo Ambalaomby\"                                                                                                                            \n  [4] \"Ankafobe\"                                                                                                                                          \n  [5] \"Anjajavy\"                                                                                                                                          \n  [6] \"Oronjia\"                                                                                                                                           \n  [7] \"Anjajavy\"                                                                                                                                          \n  [8] \"Foret Naturelle de Tsitongambarika\"                                                                                                                \n  [9] \"Complexe Zones Humides Mahavavy Kinkony\"                                                                                                           \n [10] \"Ambodivahibe\"                                                                                                                                      \n [11] \"Maromizaha\"                                                                                                                                        \n [12] \"Nosy Antsoha\"                                                                                                                                      \n [13] \"Ambohitr' Antsingy Montagne des Français\"                                                                                                          \n [14] \"Paysage Harmonieux Protégée Bemanevika\"                                                                                                            \n [15] \"Sakara\"                                                                                                                                            \n [16] \"Anjajavy\"                                                                                                                                          \n [17] \"Behara Tranomaro, Sud-Ouest Ifotaky, Torotorofotsy, Ambohidray, Angavo, Ranobe Bay, Vohidefo, Bombetoka Belobaka, Ranobe PK 32 et Ambararata Londa\"\n [18] \"Ambodivahibe\"                                                                                                                                      \n [19] \"Maromizaha\"                                                                                                                                        \n [20] \"Nord-Ifotaka\"                                                                                                                                      \n [21] \"Amoron'i Onilahy\"                                                                                                                                  \n [22] \"Ambatotsirongorongo\"                                                                                                                               \n [23] \"Ankarabolava\"                                                                                                                                      \n [24] \"Agnakatrika\"                                                                                                                                       \n [25] \"Ampanangandehibe-Behasina\"                                                                                                                         \n [26] \"Ampanangandehibe-Behasina\"                                                                                                                         \n [27] \"Analalava\"                                                                                                                                         \n [28] \"Corridor Ankeniheny-Zahamena\"                                                                                                                      \n [29] \"Corridor Forestier Ambositra-Vondrozo\"                                                                                                             \n [30] \"Lac Alaotra\"                                                                                                                                       \n [31] \"Rivière Nosivolo\"                                                                                                                                  \n [32] \"Loky Manambato\"                                                                                                                                    \n [33] \"Menabe Antimena\"                                                                                                                                   \n [34] \"Complexe Anjozorobe-Angavo\"                                                                                                                        \n [35] \"Massif d'Ibity\"                                                                                                                                    \n [36] \"Réserve Spéciale Pointe à Larrée\"                                                                                                                  \n [37] \"Vohidava-Betsimilaho\"                                                                                                                              \n [38] \"Ambohitr'Antsingy Montagne des Français\"                                                                                                           \n [39] \"Tsinjoriake\"                                                                                                                                       \n [40] \"Mahialambo\"                                                                                                                                        \n [41] \"Analabe Betanatanana\"                                                                                                                              \n [42] \"Allée des Baobabs\"                                                                                                                                 \n [43] \"Andrafiamena Andavakoera\"                                                                                                                          \n [44] \"Nosy Antsoha\"                                                                                                                                      \n [45] \"Velondriake\"                                                                                                                                       \n [46] \"Ampasindava\"                                                                                                                                       \n [47] \"Galoko-Kalobinono\"                                                                                                                                 \n [48] \"Agnalazaha\"                                                                                                                                        \n [49] \"Makirovana Tsihomanaomby\"                                                                                                                          \n [50] \"Analalava\"                                                                                                                                         \n [51] \"Forêt Sacrée Alandraza Anavelo\"                                                                                                                    \n [52] \"Forêt Naturelle de Petriky\"                                                                                                                        \n [53] \"Ambatoatsinanana\"                                                                                                                                  \n [54] \"Ankodida\"                                                                                                                                          \n [55] \"Mandena\"                                                                                                                                           \n [56] \"Complexe des Aires Protégées Ambohimirahavavy\"                                                                                                     \n [57] \"Complexe Zones Humides Mangoky Ihotry\"                                                                                                             \n [58] \"Ankarea\"                                                                                                                                           \n [59] \"Mangabe-Ranomena-Sahasarotra\"                                                                                                                      \n [60] \"Beanka\"                                                                                                                                            \n [61] \"Sahafina\"                                                                                                                                          \n [62] \"Marolambo\"                                                                                                                                         \n [63] \"Site Bioculturel d'Antrema\"                                                                                                                        \n [64] \"Mandrozo\"                                                                                                                                          \n [65] \"Marolambo\"                                                                                                                                         \n [66] \"Nosy Ve Androka\"                                                                                                                                   \n [67] \"Ankivonjy\"                                                                                                                                         \n [68] \"Complexe Tsimembo Manambolomaty\"                                                                                                                   \n [69] \"Complexe Zones Humides Mahavavy Kinkony\"                                                                                                           \n [70] \"Soariake\"                                                                                                                                          \n [71] \"Ambatofotsy\"                                                                                                                                       \n [72] \"Ampotaka-Ankarabe\"                                                                                                                                 \n [73] \"Corridor Ankeniheny-Zahamena\"                                                                                                                      \n [74] \"Corridor Forestier Ambositra-Vondrozo\"                                                                                                             \n [75] \"Iles Barren\"                                                                                                                                       \n [76] \"Loky Manambato\"                                                                                                                                    \n [77] \"Complexe Mahavavy Kinkony\"                                                                                                                         \n [78] \"Menabe Antimena\"                                                                                                                                   \n [79] \"Corridor Marojejy Anjanaharibe Tsaratanana\"                                                                                                        \n [80] \"Nouvelle Aire Protégée Manjakatompo-Ankaratra\"                                                                                                     \n [81] \"Corridor Ankeniheny Zahamena\"                                                                                                                      \n [82] \"Corridor Forestier Ambositra Vondrozo\"                                                                                                             \n [83] \"Makira\"                                                                                                                                            \n [84] \"Complexe de zones humides de la Mangoky\"                                                                                                           \n [85] \"Complexe Manambolomaty\"                                                                                                                            \n [86] \"Massif d'Ibity\"                                                                                                                                    \n [87] \"Forêt de Tsitongambarika\"                                                                                                                          \n [88] \"Alan' i Vohibe\"                                                                                                                                    \n [89] \"Ranobe PK 32\"                                                                                                                                      \n [90] \"Allée des Baobab\"                                                                                                                                  \n [91] \"Nord-lfotaky\"                                                                                                                                      \n [92] \"Tampolo\"                                                                                                                                           \n [93] \"Ambatotsirongorongo\"                                                                                                                               \n [94] \"Mandena\"                                                                                                                                           \n [95] \"Kodida\"                                                                                                                                            \n [96] \"Ambato Atsinanana (Sainte Luce)\"                                                                                                                   \n [97] \"Couloir forestier d’Anjozorobe-Angavo\"                                                                                                             \n [98] \"Complexe Mikea\"                                                                                                                                    \n [99] \"Complexe Mahavavy-Kinkony\"                                                                                                                         \n[100] \"Amoron'i Onilahy\"                                                                                                                                  \n[101] \"Lac Alaotra\"                                                                                                                                       \n[102] \"Complexe Andreba\"                                                                                                                                  \n[103] \"Makira\"                                                                                                                                            \n[104] \"Corridor Forestier Ankeniheny-Zahamena\"                                                                                                            \n[105] \"Couloir forestier d’Anjozorobe-Angavo\"                                                                                                             \n[106] \"Corridor Forestier Bongolava\"                                                                                                                      \n[107] \"Montagne des Français\"                                                                                                                             \n[108] \"Corridor Forestier Fandriana- Vondrozo\"                                                                                                            \n[109] \"Forêt d'Analalava\"                                                                                                                                 \n[110] \"Mandena\"                                                                                                                                           \n[111] \"Ambato-Antsinanana (Sainte-Luce)\"                                                                                                                  \n[112] \"Menabe Central\"                                                                                                                                    \n[113] \"Nord-Ifotaky\"                                                                                                                                      \n[114] \"Kodida\"                                                                                                                                            \n[115] \"Corridor Forestier Ankeniheny-Zahamena\"                                                                                                            \n[116] \"Makira\"                                                                                                                                            \n[117] \"Couloir Forestier d'Anjozorobe-Angavo\"                                                                                                             \n[118] \"Massif d'Itremo\"                                                                                                                                   \n\n\nCode\n# Harmonization for comparison (without modifying original data)\nsapm_clean &lt;- sapm_2017 %&gt;%\n  mutate(cleaned_SHORT_NAME = str_trim(str_to_lower(SHORT_NAME)))\n\nclass_clean &lt;- class_results %&gt;%\n  mutate(cleaned_pa = str_trim(str_to_lower(pa)))\n\n# Split cells containing multiple names (both \", \" and \" et \" as separators)\nsplit_class_clean &lt;- class_clean %&gt;%\n  mutate(cleaned_pa_split = str_split(cleaned_pa, \",\\\\s*|\\\\s+et\\\\s+\")) %&gt;%  # Split on commas or \" et \"\n  unnest(cleaned_pa_split) %&gt;%\n  rename(single_cleaned_pa = cleaned_pa_split)  # Rename for clarity\n\n# Function to compute proportional string distance\nmatch_pa_to_sapm &lt;- function(pa_name, sapm_names) {\n  # Calculate proportional distances\n  distances &lt;- stringdist(\n    a = pa_name,\n    b = sapm_names,\n    method = \"lv\"  # Levenshtein distance\n  ) / pmax(nchar(pa_name), nchar(sapm_names))\n  \n  # Find the best match\n  best_match_idx &lt;- which.min(distances)\n  list(\n    closest_match = sapm_names[best_match_idx],\n    match_distance = distances[best_match_idx]\n  )\n}\n\n# Find closest matches for each split name\nconversion_table &lt;- split_class_clean %&gt;%\n  rowwise() %&gt;%\n  mutate(\n    match_result = list(match_pa_to_sapm(single_cleaned_pa, sapm_clean$cleaned_SHORT_NAME)),\n    closest_match = sapm_clean$SHORT_NAME[which.min(\n      stringdist(single_cleaned_pa, sapm_clean$cleaned_SHORT_NAME) / \n        pmax(nchar(single_cleaned_pa), nchar(sapm_clean$cleaned_SHORT_NAME))\n    )],\n    match_distance = min(\n      stringdist(single_cleaned_pa, sapm_clean$cleaned_SHORT_NAME) /\n        pmax(nchar(single_cleaned_pa), nchar(sapm_clean$cleaned_SHORT_NAME))\n    )\n  ) %&gt;%\n  ungroup() %&gt;%\n  select(original_pa = single_cleaned_pa, closest_match, match_distance)\n\n\nwritexl::write_xlsx(conversion_table, \"conversion_table.xlsx\")\n\n\nCette base est envoyée vers excel et on effectue une vérification manuelle pour avoir une liste complète des rapprochements."
  }
]